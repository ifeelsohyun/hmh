<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>íƒ•í™”ì¿µí‘¸ë§ˆë¼íƒ• ê¸¸ì°¾ê¸°</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- ê¸°ì¡´ ì‚¬ì´íŠ¸ ìŠ¤íƒ€ì¼ -->
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">

  <!-- Leaflet -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>

  <!-- map.html ì „ìš© ìŠ¤íƒ€ì¼ (ì‹¬í”Œ ë²„ì „) -->
  <style>
    body {
      margin: 0;
      font-family: "Noto Sans KR", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: #0f172a;
      color: #111827;
    }

    header {
      background: #0f172a;
      color: #f9fafb;
      padding: 10px 18px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-sizing: border-box;
      border-bottom: 1px solid rgba(148, 163, 184, 0.4);
    }

    header h1 {
      font-size: 1rem;
      margin: 0;
    }

    header a {
      color: #93c5fd;
      font-size: 0.85rem;
      text-decoration: none;
    }

    .map-fullpage {
      position: relative;
      width: 100%;
      height: calc(100vh - 50px); /* í—¤ë” ì œì™¸ ì „ì²´ í™”ë©´ */
      background: #020617;
    }

    #leafletMap {
      width: 100%;
      height: 100%;
    }

    /* ìƒë‹¨ ì•ˆë‚´ ë°” */
    .map-top-banner {
      position: absolute;
      top: 12px;
      left: 50%;
      transform: translateX(-50%);
      padding: 8px 14px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.86);
      color: #e5e7eb;
      font-size: 0.8rem;
      display: flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 12px 30px rgba(15, 23, 42, 0.8);
      z-index: 1000;
      pointer-events: none;
    }

    .map-top-banner span.icon {
      font-size: 1rem;
    }

    /* ì˜¤ë¥¸ìª½ ì•„ë˜ ë²„íŠ¼ */
    .map-floating-actions {
      position: absolute;
      right: 16px;
      bottom: 16px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      z-index: 1000;
    }

    .map-btn {
      border: none;
      border-radius: 999px;
      padding: 10px 16px;
      font-size: 0.85rem;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.55);
      white-space: nowrap;
    }

    .map-btn-primary {
      background: #2563eb;
      color: #f9fafb;
    }

    .map-btn-primary:disabled {
      background: #4b5563;
      cursor: default;
      box-shadow: none;
    }

    .map-btn-secondary {
      background: rgba(15, 23, 42, 0.88);
      color: #e5e7eb;
    }

    /* ê²½ë¡œ ìŠ¤íƒ€ì¼ */
    .route-main {
      stroke: #60a5fa;
      stroke-width: 5;
      stroke-linecap: round;
      stroke-linejoin: round;
    }
    .route-shadow {
      stroke: rgba(15, 23, 42, 0.7);
      stroke-width: 9;
      stroke-linecap: round;
      stroke-linejoin: round;
    }

    /* ë‚´ ìœ„ì¹˜ ë§ˆì»¤ */
    .user-marker-badge {
      background: #2563eb;
      color: #ffffff;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 11px;
      box-shadow: 0 8px 16px rgba(37, 99, 235, 0.5);
    }

    /* ê°€ê²Œ ë§ˆì»¤ */
    .store-marker-badge {
      background: #f97316;
      color: #111827;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 11px;
      box-shadow: 0 8px 16px rgba(248, 113, 22, 0.55);
      font-weight: 700;
    }
  </style>
</head>
<body>

<header>
  <h1>ğŸ—º íƒ•í™”ì¿µí‘¸ë§ˆë¼íƒ• ê¸¸ì°¾ê¸°</h1>
  <a href="inform-f10.html">â† ìƒì„¸ í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°</a>
</header>

<div class="map-fullpage">
  <div id="leafletMap"></div>

  <!-- ìƒë‹¨ ì•ˆë‚´ -->
  <div class="map-top-banner" id="statusBanner">
    <span class="icon">ğŸ“¡</span>
    <span id="statusText">í˜„ì¬ ìœ„ì¹˜ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤. ë¸Œë¼ìš°ì €ì˜ ìœ„ì¹˜ ì‚¬ìš©ì„ í—ˆìš©í•´ ì£¼ì„¸ìš”.</span>
  </div>

  <!-- ìš°ì¸¡ í•˜ë‹¨ ë²„íŠ¼ë“¤ -->
  <div class="map-floating-actions">
    <button id="openMapBtn" class="map-btn map-btn-primary" disabled>
      ğŸ—º êµ¬ê¸€ ì§€ë„ì—ì„œ ê¸¸ì°¾ê¸° ì—´ê¸°
    </button>
    <!-- í•„ìš”í•˜ë©´ ë‚˜ì¤‘ì— 'ë‹¤ì‹œ ìœ„ì¹˜ ë¶ˆëŸ¬ì˜¤ê¸°' ê°™ì€ ë²„íŠ¼ë„ ì¶”ê°€ ê°€ëŠ¥ -->
  </div>
</div>

<script>
  // âœ… ëª©ì ì§€: ë³´ë°°ë°˜ì  (ì •í™• ì¢Œí‘œ/ì£¼ì†Œ)
  const DEST_LAT = 37.300951;        // ìœ„ë„
  const DEST_LNG = 126.837996;       // ê²½ë„
  const destName = "íƒ•í™”ì¿µí‘¸ë§ˆë¼íƒ•";
  const destAddress = "ê²½ê¸°ë„ ì•ˆì‚°ì‹œ ìƒë¡êµ¬ ì„±ì•ˆê¸¸ 78-3";

  const statusBanner = document.getElementById("statusBanner");
  const statusText   = document.getElementById("statusText");
  const openMapBtn   = document.getElementById("openMapBtn");

  let map;
  let userMarker = null;
  let destMarker = null;
  let routeLineMain = null;
  let routeLineShadow = null;
  let currentLat = null;
  let currentLng = null;

  // ì§€ë„ ì´ˆê¸°í™”
  function initMap() {
    map = L.map("leafletMap").setView([DEST_LAT, DEST_LNG], 17);

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 19,
      attribution: "&copy; OpenStreetMap contributors"
    }).addTo(map);

    // ëª©ì ì§€ ë§ˆì»¤ (ì˜ˆì˜ê²Œ)
    destMarker = L.marker([DEST_LAT, DEST_LNG], {
      icon: L.divIcon({
        className: "",
        html: '<div class="store-marker-badge">ğŸ² íƒ•í™”ì¿µí‘¸</div>',
        iconSize: [40, 40],
        iconAnchor: [20, 20]
      })
    }).addTo(map);

    destMarker.bindPopup(`${destName}<br>${destAddress}`);
  }

  // OSRMìœ¼ë¡œ ë„ë¡œ ê²½ë¡œ ê¸ì–´ì™€ì„œ ê·¸ë¦¬ê¸°
  async function drawRouteWithOSRM(startLat, startLng, endLat, endLng) {
    const url =
      `https://router.project-osrm.org/route/v1/foot/` +
      `${startLng},${startLat};${endLng},${endLat}` +
      `?overview=full&geometries=geojson`;

    try {
      statusText.textContent = "ë„ë¡œë¥¼ ë”°ë¼ê°€ëŠ” ê²½ë¡œë¥¼ ê³„ì‚°í•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤...";

      const res = await fetch(url);
      if (!res.ok) throw new Error("OSRM ìš”ì²­ ì‹¤íŒ¨");

      const data = await res.json();
      if (!data.routes || !data.routes[0]) throw new Error("ê²½ë¡œ ë°ì´í„° ì—†ìŒ");

      const coords = data.routes[0].geometry.coordinates; // [lng, lat]
      const latLngs = coords.map(c => [c[1], c[0]]);       // [lat, lng]ë¡œ ë³€í™˜

      // ê¸°ì¡´ ê²½ë¡œ ì œê±°
      if (routeLineMain) routeLineMain.remove();
      if (routeLineShadow) routeLineShadow.remove();

      // ê·¸ë¦¼ì ë¼ì¸
      routeLineShadow = L.polyline(latLngs, {
        className: "route-shadow"
      }).addTo(map);

      // ë©”ì¸ íŒŒë€ ë¼ì¸
      routeLineMain = L.polyline(latLngs, {
        className: "route-main"
      }).addTo(map);

      map.fitBounds(routeLineMain.getBounds(), { padding: [40, 40] });

      statusText.textContent = "ê²½ë¡œê°€ í‘œì‹œë˜ì—ˆìŠµë‹ˆë‹¤. íŒŒë€ ê¸¸ì„ ë”°ë¼ê°€ë©´ ë¼ìš”!";
    } catch (err) {
      console.error(err);
      statusText.textContent = "ë„ë¡œ ê²½ë¡œë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ì§ì„  ê²½ë¡œë¡œ í‘œì‹œí• ê²Œìš”.";

      if (routeLineMain) routeLineMain.remove();
      if (routeLineShadow) routeLineShadow.remove();

      const straight = [
        [startLat, startLng],
        [endLat, endLng]
      ];

      routeLineMain = L.polyline(straight, {
        color: "#60a5fa",
        weight: 5,
        opacity: 0.9
      }).addTo(map);

      map.fitBounds(routeLineMain.getBounds(), { padding: [40, 40] });
    }
  }

  // ë‚´ ìœ„ì¹˜ ìë™ìœ¼ë¡œ ë¶ˆëŸ¬ì˜¤ê¸°
  function requestLocation() {
    if (!navigator.geolocation) {
      statusText.textContent = "ì´ ë¸Œë¼ìš°ì €ì—ì„œëŠ” ìœ„ì¹˜ ì •ë³´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ì–´ìš”.";
      return;
    }

    statusText.textContent = "í˜„ì¬ ìœ„ì¹˜ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤. ë¸Œë¼ìš°ì €ì˜ ìœ„ì¹˜ ì‚¬ìš© í—ˆìš©ì„ ëˆŒëŸ¬ ì£¼ì„¸ìš”.";

    navigator.geolocation.getCurrentPosition(
      (position) => {
        currentLat = position.coords.latitude;
        currentLng = position.coords.longitude;

        // ë‚´ ìœ„ì¹˜ ë§ˆì»¤ í‘œì‹œ
        if (userMarker) userMarker.remove();
        userMarker = L.marker([currentLat, currentLng], {
          icon: L.divIcon({
            className: "",
            html: '<div class="user-marker-badge">ì¶œë°œ</div>',
            iconSize: [40, 40],
            iconAnchor: [20, 20]
          })
        }).addTo(map);

        statusText.textContent = "ìœ„ì¹˜ë¥¼ ë¶ˆëŸ¬ì™”ì–´ìš”. ê²½ë¡œë¥¼ ê³„ì‚°í•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤...";

        // ë„ë¡œ ê²½ë¡œ ê·¸ë¦¬ê¸°
        drawRouteWithOSRM(currentLat, currentLng, DEST_LAT, DEST_LNG);

        // êµ¬ê¸€ ì§€ë„ ë²„íŠ¼ í™œì„±í™”
        openMapBtn.disabled = false;
      },
      (error) => {
        console.error(error);
        switch (error.code) {
          case error.PERMISSION_DENIED:
            statusText.textContent = "ìœ„ì¹˜ ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ ê¶Œí•œì„ í—ˆìš©í•´ ì£¼ì„¸ìš”.";
            break;
          case error.POSITION_UNAVAILABLE:
            statusText.textContent = "ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
            break;
          case error.TIMEOUT:
            statusText.textContent = "ìœ„ì¹˜ ì •ë³´ ìš”ì²­ì´ ì‹œê°„ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤.";
            break;
          default:
            statusText.textContent = "ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
        }
      }
    );
  }

  // êµ¬ê¸€ ì§€ë„ì—ì„œ ê¸¸ì°¾ê¸° ì—´ê¸°
  openMapBtn.addEventListener("click", () => {
    if (currentLat == null || currentLng == null) return;

    const origin = `${currentLat},${currentLng}`;
    const destination = encodeURIComponent(destAddress);

    const url =
      `https://www.google.com/maps/dir/?api=1&origin=${origin}` +
      `&destination=${destination}&travelmode=walking`;

    window.open(url, "_blank");
  });

  // í˜ì´ì§€ ë¡œë“œ ì‹œ ë°”ë¡œ ì§€ë„ ë„ìš°ê³ , ê³§ë°”ë¡œ ìœ„ì¹˜ ìš”ì²­
  document.addEventListener("DOMContentLoaded", () => {
    initMap();
    requestLocation();
  });
</script>
<script src="darkmode.js"></script>
</body>
</html>

</body>
</html>
